# 네이버 FE플랫폼 김희재
# View360 개발기
# 오픈소스화로 기술부채 청산한 이야기


사내용으로 개발하다가 문제가 생겼고..

오픈소스 생태계에 뛰어드는걸 어떻게 하게도이ㅓㅆ는지에 대한 이야기

소프트웨어 개발 과정에서
기술부채가 왜 발생했고
프로젝트에 어떤 영향을 주었으며
오픈소스로 어떻게 문제상황을 벗어날 수 있었는지

360도 사진 올리면 360도사진 볼수 있따.

모바일 환경에서 잘 작동하고, 모션이 부드럽게 작동하도록 중점으로

현재는 네이버TV에 적용중
360영상도 모바일 브라우저에서 곧!

유트브에서는 안되지만 네이버에서는 되게!!

자기소개
FE플랫폼
FE기술 지원 조직
사내 서비스들을 위한 WEB UI 라이브러리 개발
경쟁력 있는 컴포넌트는 오픈소스로 공개
egjs, billboard.js, jindo.js

c3js를 포크한 차트라이브러리

입사후 1년뒤에 360도 뷰어 만들어보실분?

디버깅하다가 처음부터 개발할 수 있는 기회가 생겨 맡고싶어짐

요구사항
1. 네이티브 WEBGL로 직접 구현 ( cjs 쓰지 않고.. 오버헤드 크기떄문, WEBGL하는사람이 없어서 역량쌓아보자는 의미에서)
2. 안드로이드 등 모바일 브라우저 호환성 확보 (다른 WEBGL보다 꺠짐이 적다)
3. 디바이스 모션 컨트롤

기술부채 발생이 불가피했던 상황
콘셉트 증명 단계로 간주

1인개발
- 협업을 위해 코드의 품질을 신경 쓸 필ㅇ가 없음


문서화> 나중에
Test Code ? 일단 돌아가야 하지 않을까... ( 없던걸 만들어내면 API도 바뀌고 구조도 바뀌기때문에)
CI통합환경툴? 없는데 무슨소용이야!!
라이브러리를 서비스 부서에 전달했는데...
버그 수정하면 다른 버그 발생
전체보기 문제 고쳤더니 또 다른데서 문제생기고...
pc에서 문제 고쳤더니 안드로이드 문제생기고...
수정하면 이상한버그 발생하고.. 악순환되니까..
2번의 배포 포기..

기술부채(Technical Debt)

빠르지만 지저분한 방식으로 일하면 기술 부채로 압박 받게됨
기술부채를 지고 빠른 출시를 할 수는 있음
기술부채를 청산하지 않으면 이자가 계속 커짐
이자 : 유지보수시 비용큼


> 테스트코드 XView360에서의 초기 기술부채

공감할 수 없는 구조설계 -> 미래의 나도 이해할 수가 없다. 코드만 봐도 구조설계가 납득될 수 있도록 구조를 잘짜야한다.
군더더기가 많은 API -> 어떤 기능이 필요하게 될지 예측해가면서 개발

문서화


> 처음부터 둘이서 만들기

처음부터 둘이서만들면 삼자가 와도 이해하기쉽지않을까
구조설계 함께 진행


오픈소스화 기준에 맞춰 부채청산 시작

구글 텐서플로 사례
텐서플로 구글사내용 툴이었음
사내용으로만 쓰니까 너무 문서화가 안되고 ,, 유지보수쉽게하려면 외부에 공개하고 문서화하자 라고 결정

> 이슈 / 커밋메시지 / 문서 는 영어로 작성

why?
지나가던 개발자는 웬만하면 영어를 씀
작성하다보면 익숙해짐
비슷한 표현을 스택오버플로우나 다른 깃허브 프로젝트 이슈에서 찾아보면서 응용하면 더 쉽다.

> 커밋메시지 잘 쓰기

이 라인을 왜 수정한거야? 히스토리 보면서 하면 아 이때 이문제때문에 이렇게 바꿨구나 라고 알 수 있다.

${작업종류} 작업대상 모듈 : 작업 내용 Ref #${해당 이슈번호} ??? <-이상함

> PR 단위 줄이기

되도록이면 1이슈 1PR

> 테스트의 중요성

기능 추가 전후 두려움이 줄어든다
테스트를 통과했다? 내가 코드를 이렇게 고쳤는데 동작에 문제가 없어 라고 보장해줌
자신감있게 문제없어요!! pr하세요!!

모르는개발자가 pr날려도 테스트 통과하면 문제가없다는걸 알 수있어요
버그가 있어서 pr이 들어와있는데, 각종 디바이스에서 테스트 해봐야되니까
다음에 시간되면 해볼게요 -> 반영이 느려짐..

테스트 작성
구조와 API 설계가 어느정도 안정되고 나서 테스트 작성 시작
테스트가 작성이 힘들면 테스트 가능성 높아지도록 리팩토링
-특정 기능을 모듈로 분리하거나 이미지로딩모듈 비디오로딩모듈 등 해당동작에대한 테스터만 진행할 수 있도록. IE브라우저를 모킹할수있게 특정 웹API는 의존성을 받아서 쓰게 그런 구조.. .무슨말인지모르겟다
- Mocking을 용이하게 리팩토링하거나
WebGL 렌더링 테스트 방법 적용 -> 360코드 40%가 WebGL관련 코드인데.. 화면에 어떻게 보여져야된다 하는 코드잖아요.. 2js라는 오픈소스가 있는데 WebGL테스터를 적용한 사례가 있더라고요 그걸 참고해서 테스터하고,.. 거기서는 로컬에서는 되는데 CI환경에서는 안되더라고요. 그부분을 해결하는데 찾기가 힘들어서 고생하면서 해결해쓴데ㅣ... 이거는 나중에 컨트리뷰션 할 수있을거같아요 ㅎㅎ

디바이스 모션은 테스트 헬퍼 구현
기계가 움지길 때 캡쳐 신호값이 나오거든요. 그런걸로 헬퍼 작성하고

> PR 단계에서 CI 활용

너 이거 테스트 부족해 ! 라고 알려주는거도 만들었어요

CI 지속적 통합
PR을 나렸을때 해당 코드 품질 체크
1. 빌드 되어야함
2. 2. 코드컨벤션 맞아야함
3. 3. 단위 테스트를 모두 통과해야함
4. 4. 테스트 커버리지가 감소하지 않아야함!! Travis CI _ coveralls 기분이좋아요

Three,js 네

이정도 테스트는 작성하기 어려우니까 그냥 pr날려야지 하면 얘가 딴지를 걸어요. 그럼 테스트를 작성하게 되죠. 빨리 개발해야하니까 이건 넘기자 하는 코드퀄리티를 떨어트리는 일을 방지해요.

coveralls에 가보면 테스트커버리지가 91%까지 올라간거는 잘한거같습니다.

> 시맨틱 버저닝

> 릴리즈할 때 소프트버전이 있잖아요 이게 몇점몇점몇 의미를 ㄹ있게하는건데

X.Y.Z (Major.Minor.Patch)
M : 업데이트 시 기존 코드를 수정해야하는 경우.
Miner : 기능 , API 추가했는데 기존코드 깨지지안흔다
Patch : 버그수정 API변경없다.

사내에서 라이브러리 고나리할땐 이걸 안썼죠

수정사항을 합치고 뭐하고 이런게없어요?? 시맨틱버전이 좋아요..

> 가이드 문서 작성하기

사내가발자 성능 좋아져도 업그레이드안해줘요

문서도 없는데 ㅇ떻게 하냐!! 안받아줘요


마이그레이션문서 써야해요

https://github.com/naver/egjs-view360/wiki

> 소개페이지 만들기

라이브러리에대한 이해를 도울 수 있음.
깃허브지만 개발자들만 보는게 아니거든요
비개발자는 소개됩니다.

> 커뮤니티에 기여하기

내 이슈 관리만 해도 공헌하고있는거같아서 재ㅣㅆ는거같아요
Tree.js 에 이슈에서 제꺼 이슈 링크달렸는데
Tree.js에 공헌한거 같잖아요 ㅎㅎㅎ

오픈소스에 기여하겠다 해서 기여한게아니고

오픈소스화하지 않으면 품질을 끌어올리기 힘들어서

오히려 기회로 이용ㅎ나 것 같아요.


포지셔닝 작업을 통해 존재이유가 생김
빠르고 가벼운 모바일웹에ㅓ도 잘 돌아가는 360동영상 / 이미지 뷰어

저 오픈소스가 더 좋은데 왜 공유했니? 소리 안들으려고 잉여컴포넌트가 되지않으려고 어느정도 필터링을하ㅗㄱ.. -> 존재이유가 생김

라이브러리 품질이 올라감

> 오픈소스화 과정을 통해 느낀점

 1. 타인을 고려하면 할수록 가치가 더해지는 소셜코딩의 힘
 혼자보다 모르는사람을 가정하고 개발하면 퀄리티가 더 올라가는 것 같아요.
 2. 나, 미래의나, 동료개발자, 타부서개발자./기획자, 경쟁오픈소스개발자, 스택오버플로우에 질문올린개발자 답변단개발자 에 도움이 되구나

> 소셜코딩으로 다같이 폭풍성장해요
